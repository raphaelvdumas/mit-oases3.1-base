      SUBROUTINE BW(Z,FREQ,SD,RD,OPT,XP,YP,ZP)

      PARAMETER (NLEV1=51)

      LOGICAL IB

      CHARACTER*80 TSAVE, TXSAVE, TYSAVE
      CHARACTER*80 TITLE,TITLEX,TITLEY
      CHARACTER*80 OPT
      CHARACTER*3 XBTYPE, YBTYPE, FONT
      CHARACTER*3 ADD, OPENED, LASTP

      REAL*4 Z(1,1), XP(1), YP(1), ZP(1)

      COMMON /FLAGS/ ADD, OPENED, LASTP
      COMMON /FONTEX/ FONT
      COMMON /PARA/ LABPT,NSM,NDIV,CAY,NARC,NRNG,HGTPT,HGT,
     & LABC(51),LWGT(51)
      COMMON /PARAC/ TITLE,SDPLOT,RDPLOT
      COMMON /PLT/ FACT,YASIZE,SCALF,SF,IB,ICOL
      COMMON /XYS/ IND10(57,6)
      COMMON /XAX/ X1,XL,XLEFT,XRIGHT,XSCALE,XINC,DX,
     & X1PL,XLPL,NX,X1GRID,XLGRID,DIVX,XVAL(100),NXVAL
      COMMON /XAXC /TITLEX, XBTYPE
      COMMON /YAX/ Y1,YL,YUP,YDOWN,YSCALE,YINC,DY,
     & Y1PL,YLPL,NY,Y1GRID,YLGRID,DIVY,YVAL(100),NYVAL
      COMMON /YAXC/ TITLEY, YBTYPE
      COMMON /ZAX/ ZMIN,ZMAX,ZINC,NLEV,ZLEV(NLEV1)


       TSAVE= TITLE
       TXSAVE= TITLEX
       TYSAVE= TITLEY

       IF(YBTYPE.EQ.'LOG')   CALL YLOG

       IF(OPENED .NE. 'YES')
     &  CALL BOXBW(X1PLN,XLPLN,Y1PLN,YLPLN,FREQ,SD,RD,OPT,XP,YP)
       CALL CONSEG(Z,NX,NY,X1PLN,Y1PLN,XLPLN,YLPLN,ZLEV,LABC,LWGT,
     & NLEV,HGTPT,NDIV,NARC,XP,YP,ZP)
       IF( LASTP .EQ. 'YES')   THEN
         CALL PLOT(0.0,0.0,999)
         OPENED= 'NO '
       ELSE
         OPENED= 'YES'
       END IF
      
       TITLE= TSAVE
       TITLEX= TXSAVE
       TITLEY= TYSAVE

       RETURN
       END
